---
phase: 02-configuration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/templates/config.json
  - get-shit-done/references/planning-config.md
autonomous: true

must_haves:
  truths:
    - "Config template includes adversary section with enabled, max_rounds, and checkpoints fields"
    - "Planning-config reference documents adversary schema with precedence chain and standard reading block"
    - "Reading block handles boolean shorthand and object form for checkpoint values"
    - "Reading block checks global enabled flag BEFORE checkpoint-level flags (kill switch works)"
  artifacts:
    - path: "get-shit-done/templates/config.json"
      provides: "Default config shape with adversary section"
      contains: '"adversary"'
    - path: "get-shit-done/references/planning-config.md"
      provides: "Adversary config schema documentation and reading block"
      contains: "adversary_config"
  key_links:
    - from: "get-shit-done/references/planning-config.md"
      to: "get-shit-done/templates/config.json"
      via: "Schema documentation matches template structure"
      pattern: '"adversary".*"enabled".*"max_rounds".*"checkpoints"'
---

<objective>
Define the adversary configuration schema — the template that new projects get and the reference documentation that orchestrators consume when reading adversary config.

Purpose: Establishes the canonical adversary config shape and the standard reading block that all future integration phases (3-5) will copy into their orchestrators. This is the foundation that CONF-01, CONF-02, and CONF-03 requirements build on.

Output: Updated config.json template with adversary section; updated planning-config.md with adversary schema docs, reading block, and precedence chain.
</objective>

<execution_context>
@/Users/zpyoung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zpyoung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-configuration/02-RESEARCH.md
@.planning/phases/02-configuration/02-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add adversary section to config.json template</name>
  <files>get-shit-done/templates/config.json</files>
  <action>
Add an `"adversary"` section as a top-level key in `get-shit-done/templates/config.json`, placed after the `"parallelization"` section and before `"gates"`.

The adversary section shape:
```json
"adversary": {
  "enabled": true,
  "max_rounds": 3,
  "checkpoints": {
    "requirements": true,
    "roadmap": true,
    "plan": true,
    "verification": true
  }
}
```

All defaults are enabled (adversary on by default for new projects). All 4 checkpoints use boolean shorthand (the simple, common case). `max_rounds: 3` is the system default.

Do NOT modify any existing sections. Only add the new adversary block.
  </action>
  <verify>
Read the updated file and confirm:
1. Valid JSON (no trailing commas, proper nesting)
2. `adversary` key exists at top level
3. Contains `enabled`, `max_rounds`, `checkpoints` with all 4 checkpoint names
4. Existing config sections unchanged
  </verify>
  <done>Config template contains adversary section with enabled=true, max_rounds=3, and all 4 checkpoints enabled</done>
</task>

<task type="auto">
  <name>Task 2: Document adversary config schema in planning-config.md</name>
  <files>get-shit-done/references/planning-config.md</files>
  <action>
Add an `<adversary_config>` section to `get-shit-done/references/planning-config.md`, placed BEFORE the closing `</planning_config>` tag. This section documents the adversary configuration for orchestrators that need to read it.

The section must include:

1. **Schema documentation** (`<config_schema>`) — JSON example showing the full adversary config shape, plus a table of all options with defaults and descriptions. Document both boolean shorthand (`"plan": true`) and object form (`"plan": { "enabled": true, "max_rounds": 4 }`). Document the three-tier precedence chain: checkpoint-level max_rounds > adversary-level max_rounds > system default (3). Document that missing config = system defaults (adversary runs).

2. **Standard reading block** (`<reading_config>`) — The canonical bash snippet using `node -e` that orchestrators copy to read adversary config for a specific checkpoint. The block must:
   - Check `adversary.enabled` FIRST — if false, short-circuit to `false|3` immediately (kill switch)
   - Handle boolean shorthand: `typeof cp === 'boolean'` → enabled=cp, rounds from adversary.max_rounds or 3
   - Handle object form: `typeof cp === 'object'` → enabled=cp.enabled, rounds from cp.max_rounds or adversary.max_rounds or 3
   - Handle missing values: all `??` operators default to enabled=true, rounds=3
   - Output format: `enabled|rounds` pipe-delimited string
   - Full try-catch with fallback to `true|3` on any error
   - `|| echo "true|3"` as bash-level fallback if node fails

Use the exact reading block from the research (02-RESEARCH.md Pattern 1) — it has been validated for all edge cases.

Add a brief note that this block is used by orchestrators in Phases 3-5 before spawning gsd-adversary. Existing config reading patterns (grep-based) remain unchanged for simple values.
  </action>
  <verify>
Read the updated file and confirm:
1. `<adversary_config>` section exists inside `<planning_config>`
2. Schema table covers: enabled, max_rounds, checkpoints.{name}, checkpoints.{name}.enabled, checkpoints.{name}.max_rounds
3. Reading block uses `node -e` (not grep)
4. Reading block checks `adv.enabled === false` before checkpoint logic
5. Reading block handles boolean AND object checkpoint values
6. All defaults documented: enabled=true, max_rounds=3, all checkpoints on
7. Existing planning_config content unchanged
  </verify>
  <done>Planning-config.md documents adversary schema with precedence chain, boolean/object polymorphism, and standard reading block for orchestrators</done>
</task>

</tasks>

<verification>
- [ ] `get-shit-done/templates/config.json` is valid JSON with adversary section
- [ ] `get-shit-done/references/planning-config.md` has adversary_config section inside planning_config
- [ ] Reading block handles: missing config, enabled=false kill switch, boolean checkpoint, object checkpoint, missing max_rounds at each level
- [ ] Precedence chain documented: checkpoint max_rounds > adversary max_rounds > system default (3)
- [ ] No existing content modified (only additions)
</verification>

<success_criteria>
1. Config template defines the adversary config shape that new projects will get
2. Planning-config reference provides the reading block that orchestrators will use
3. Both files are consistent (same schema, same defaults)
</success_criteria>

<output>
After completion, create `.planning/phases/02-configuration/02-01-SUMMARY.md`
</output>
