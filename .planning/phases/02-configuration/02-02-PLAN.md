---
phase: 02-configuration
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - commands/gsd/new-project.md
  - commands/gsd/settings.md
  - docs/reference/templates.md
autonomous: true

must_haves:
  truths:
    - "New projects get adversary config via /gsd:new-project workflow preferences"
    - "Existing projects can toggle adversary and checkpoints via /gsd:settings"
    - "Settings command preserves checkpoint preferences when toggling global enable/disable"
    - "docs/reference/templates.md shows adversary section in config.json example"
  artifacts:
    - path: "commands/gsd/new-project.md"
      provides: "Adversary preferences in Phase 5 workflow setup"
      contains: "Adversary"
    - path: "commands/gsd/settings.md"
      provides: "Adversary toggle and checkpoint selection in settings"
      contains: "Adversary"
    - path: "docs/reference/templates.md"
      provides: "Adversary config documentation for users"
      contains: '"adversary"'
  key_links:
    - from: "commands/gsd/new-project.md"
      to: ".planning/config.json"
      via: "Phase 5 writes adversary section to config.json"
      pattern: '"adversary".*"enabled"'
    - from: "commands/gsd/settings.md"
      to: ".planning/config.json"
      via: "Settings reads existing config, merges adversary changes"
      pattern: "adversary"
---

<objective>
Wire adversary configuration into the two commands that create and modify config.json — /gsd:new-project (initial setup) and /gsd:settings (ongoing changes). Update user-facing documentation.

Purpose: Without this, users have no way to configure adversary behavior except manually editing config.json. This plan makes adversary config accessible through the standard GSD workflow.

Output: Updated new-project.md with adversary questions, updated settings.md with adversary section, updated templates.md with adversary documentation.
</objective>

<execution_context>
@/Users/zpyoung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zpyoung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-configuration/02-RESEARCH.md
@.planning/phases/02-configuration/02-CONTEXT.md
@.planning/phases/02-configuration/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add adversary preferences to new-project.md</name>
  <files>commands/gsd/new-project.md</files>
  <action>
Add adversary configuration to `/gsd:new-project` Phase 5 (Workflow Preferences).

**Round 2 addition:** After the existing workflow agent questions (Research, Plan Check, Verifier, Model Profile), add an adversary toggle question:

```
{
  header: "Adversary",
  question: "Enable adversarial review? (challenges artifacts at key checkpoints)",
  multiSelect: false,
  options: [
    { label: "Yes (Recommended)", description: "Catch assumptions before they cause problems" },
    { label: "No", description: "Skip adversarial review" }
  ]
}
```

**Config.json update:** Update the config.json shape written in Phase 5 to include the adversary section. When adversary is enabled (Yes), write:
```json
"adversary": {
  "enabled": true,
  "max_rounds": 3,
  "checkpoints": {
    "requirements": true,
    "roadmap": true,
    "plan": true,
    "verification": true
  }
}
```

When adversary is disabled (No), write:
```json
"adversary": {
  "enabled": false,
  "max_rounds": 3,
  "checkpoints": {
    "requirements": true,
    "roadmap": true,
    "plan": true,
    "verification": true
  }
}
```

Note: Even when disabled, preserve checkpoint defaults so re-enabling doesn't lose preferences.

Do NOT add a separate checkpoint selection question to new-project — keep it simple (just the global toggle). Checkpoint granularity is available via `/gsd:settings` after project creation.

**Commit message update:** Add `Adversary: [on/off]` to the config commit message template.

**Agent table update:** Add the Adversary agent to the Round 2 agent table:

| Agent | When it runs | What it does |
|-------|--------------|--------------|
| **Adversary** | At workflow checkpoints | Challenges assumptions and stress-tests feasibility |

Place after the existing three agents (Researcher, Plan Checker, Verifier).
  </action>
  <verify>
Read the updated file and confirm:
1. Adversary question exists in Phase 5 Round 2
2. Config.json shape includes adversary section
3. Both enabled=true and enabled=false paths write full adversary section
4. Checkpoint preferences preserved in both paths
5. Commit message template includes Adversary status
6. Agent table includes Adversary row
7. No existing Phase 5 content broken
  </verify>
  <done>New projects prompt for adversary preference and write adversary config to config.json</done>
</task>

<task type="auto">
  <name>Task 2: Add adversary settings to settings.md</name>
  <files>commands/gsd/settings.md</files>
  <action>
Add adversary configuration to `/gsd:settings`.

**Step 2 (Read Current Config):** Add adversary values to the parsed config list:
- `adversary.enabled` — global adversary toggle (default: `true`)
- `adversary.checkpoints.*` — per-checkpoint toggles (default: all `true`)
- `adversary.max_rounds` — global max debate rounds (default: `3`)

**Step 3 (Present Settings):** Add three adversary questions AFTER the existing 5 questions (Model, Research, Plan Check, Verifier, Branching):

Question 6 — Global adversary toggle:
```
{
  header: "Adversary",
  question: "Enable adversarial review? (challenges artifacts before execution)",
  multiSelect: false,
  options: [
    { label: "Yes (Recommended)", description: "Challenge requirements, roadmaps, plans, and verification" },
    { label: "No", description: "Skip adversarial review at all checkpoints" }
  ]
}
```

Question 7 — Checkpoint selection (ONLY shown if adversary enabled):
```
{
  header: "Adversary Checkpoints",
  question: "Which checkpoints should trigger adversarial review?",
  multiSelect: true,
  options: [
    { label: "Requirements", description: "Challenge REQUIREMENTS.md after creation" },
    { label: "Roadmap", description: "Challenge ROADMAP.md after creation" },
    { label: "Plan", description: "Challenge PLAN.md after creation" },
    { label: "Verification", description: "Challenge verification conclusions" }
  ]
}
```

Question 8 — Max rounds (ONLY shown if adversary enabled):
```
{
  header: "Max Rounds",
  question: "Maximum debate rounds per checkpoint?",
  multiSelect: false,
  options: [
    { label: "1", description: "Single challenge only (fastest)" },
    { label: "2", description: "Challenge + defense" },
    { label: "3 (Recommended)", description: "Challenge + defense + final assessment" },
    { label: "5", description: "Extended debate (most thorough)" }
  ]
}
```

**Step 4 (Update Config):** Update the config merge to include adversary section. CRITICAL: Read existing config first and merge — do NOT replace the entire adversary object. When toggling `enabled: false`, preserve existing checkpoint values. When toggling checkpoints, write `true` for selected and `false` for unselected. Max rounds writes the numeric value to `adversary.max_rounds`.

Updated config shape in the merge example:
```json
{
  ...existing_config,
  "adversary": {
    "enabled": true/false,
    "max_rounds": 1/2/3/5,
    "checkpoints": {
      "requirements": true/false,
      "roadmap": true/false,
      "plan": true/false,
      "verification": true/false
    }
  }
}
```

**Step 5 (Confirm Changes):** Add adversary rows to the settings display table:

| Adversary            | {On/Off} |
| Adversary Checkpoints| {list of enabled checkpoints} |
| Max Rounds           | {1/2/3/5} |

**Update success_criteria:** Change from "5 settings" to "8 settings (profile + 3 workflow + branching + 3 adversary)".
  </action>
  <verify>
Read the updated file and confirm:
1. Three adversary questions added (global toggle, checkpoints, max rounds)
2. Checkpoint and max rounds questions conditional on adversary enabled
3. Config merge preserves existing checkpoint values when toggling enabled
4. Settings display table includes adversary rows
5. Success criteria updated to reflect new setting count
6. Existing settings unchanged
  </verify>
  <done>Settings command exposes adversary toggle, checkpoint selection, and max rounds configuration</done>
</task>

<task type="auto">
  <name>Task 3: Update docs/reference/templates.md with adversary config</name>
  <files>docs/reference/templates.md</files>
  <action>
Update the config.json section in `docs/reference/templates.md` to include the adversary configuration.

**Update the config.json example** (under "### config.json") to include the adversary section:

```json
{
  "mode": "interactive",
  "depth": "standard",
  "model_profile": "balanced",
  "workflow": {
    "research": true,
    "plan_check": true,
    "verifier": true
  },
  "adversary": {
    "enabled": true,
    "max_rounds": 3,
    "checkpoints": {
      "requirements": true,
      "roadmap": true,
      "plan": true,
      "verification": true
    }
  },
  "git": {
    "branching_strategy": "none"
  }
}
```

Add a brief description after the example explaining the adversary section:

> The `adversary` section controls the adversarial review agent. `enabled` is a global kill switch. Individual `checkpoints` can be toggled independently (boolean shorthand or object form with `max_rounds` override). See `planning-config.md` for full schema and reading block.

Do NOT add a full schema reference here — that lives in planning-config.md. This is just enough for users to understand what the section does.
  </action>
  <verify>
Read the updated file and confirm:
1. Config.json example includes adversary section
2. Brief description explains the adversary section purpose
3. References planning-config.md for full schema
4. Existing documentation unchanged
  </verify>
  <done>User-facing documentation shows adversary config in config.json template with brief explanation</done>
</task>

</tasks>

<verification>
- [ ] `commands/gsd/new-project.md` prompts for adversary preference in Phase 5 and writes config
- [ ] `commands/gsd/settings.md` exposes adversary toggle, checkpoints, and max rounds
- [ ] Settings command preserves checkpoint preferences when toggling global enable/disable
- [ ] `docs/reference/templates.md` shows adversary config in example
- [ ] All three files are valid markdown with proper structure
- [ ] No existing functionality broken in any file
</verification>

<success_criteria>
1. Running /gsd:new-project will ask about adversary and write adversary config to config.json
2. Running /gsd:settings will show adversary options and update config.json accordingly
3. Users reading docs/reference/templates.md will see adversary config documented
</success_criteria>

<output>
After completion, create `.planning/phases/02-configuration/02-02-SUMMARY.md`
</output>
