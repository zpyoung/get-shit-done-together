---
phase: 08-workflow-integration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd/plan-phase.md
  - commands/gsd/execute-phase.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "CO_PLANNER_REVISED_PLANS flag is assigned before it is checked in plan-phase.md"
    - "CO_PLANNER_REVISED_VERIFICATION flag is assigned before it is checked in execute-phase.md"
    - "Co-planner commit messages use dynamic phase scope, not hardcoded docs(08):"
    - "Synthesis sections in plan-phase.md and execute-phase.md have explicit Accept-if/Reject-if/Note-if criteria"
    - "All-agents-failed handler exists in plan-phase.md and execute-phase.md co-planner sections"
  artifacts:
    - path: "commands/gsd/plan-phase.md"
      provides: "Co-planner synthesis with flag assignment, dynamic commit scope, acceptance criteria, all-agents-failed handler"
      contains: "CO_PLANNER_REVISED_PLANS=true"
    - path: "commands/gsd/execute-phase.md"
      provides: "Co-planner synthesis with flag assignment, dynamic commit scope, acceptance criteria, all-agents-failed handler"
      contains: "CO_PLANNER_REVISED_VERIFICATION=true"
  key_links:
    - from: "plan-phase.md synthesis section"
      to: "conditional commit block"
      via: "CO_PLANNER_REVISED_PLANS flag"
      pattern: "CO_PLANNER_REVISED_PLANS"
    - from: "execute-phase.md synthesis section"
      to: "conditional commit block"
      via: "CO_PLANNER_REVISED_VERIFICATION flag"
      pattern: "CO_PLANNER_REVISED_VERIFICATION"
---

<objective>
Close all four verification gaps in the Phase 8 co-planner review sections of plan-phase.md and execute-phase.md.

Purpose: Bring plan-phase.md and execute-phase.md co-planner sections to the same standard as new-project.md — fixing dead conditional commits, hardcoded phase scope, missing acceptance criteria, and missing all-agents-failed handler.

Output: Two modified command files with fully functional co-planner review sections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-workflow-integration/08-VERIFICATION.md
@.planning/phases/08-workflow-integration/08-02-SUMMARY.md

Reference implementation (the gold standard these fixes mirror):
@commands/gsd/new-project.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix co-planner review section in plan-phase.md (4 gaps)</name>
  <files>commands/gsd/plan-phase.md</files>
  <action>
Apply four targeted edits to the step 12.3 co-planner review section in plan-phase.md. Use new-project.md lines 938-974 as the reference pattern.

**Gap 1 — All-agents-failed handler (after line 540):**
After the error-check step (step 3, "Skip to next agent."), add a new step 4:

```
4. **If ALL agents failed:** Display warning and skip to step 12.5.
   ```
   ⚠ All co-planners failed. Proceeding with adversary review only.
   ```
```

Renumber the existing step 4 ("Display attributed feedback block") to step 5.

**Gap 3 — Acceptance criteria (replace lines ~560-562):**
Replace the bare synthesis instructions:
```
Synthesize: Review all suggestions and challenges. For each:
- Accept: apply change to the relevant PLAN.md file(s) via Write tool
- Reject: note with brief reasoning
```

With the full criteria pattern (adapted for plan artifacts):
```
**Co-Planner Synthesis:**

Review all suggestions and challenges. For each feedback item, apply acceptance criteria:

- **Accept** if feedback identifies: a logical gap in the plan, a dependency conflict between tasks, an incorrect task ordering, a missing verification step, a feasibility concern with specific technical evidence, or a wiring gap between components.
- **Reject** if feedback is: stylistic/formatting preference, a scope expansion beyond the phase goal, speculative ("might need") without evidence, or duplicates an existing task.
- **Note** if feedback is: valid but deferred to a later phase, or raises a concern already captured in existing plan constraints.
```

**Gap 1 — Flag assignment (replace line ~561 area):**
After the acceptance criteria, add the flag-assignment instruction (matching new-project.md line 974 pattern):
```
Apply accepted changes to the relevant PLAN.md file(s) via Write tool (read current content, apply changes, write back). Set `CO_PLANNER_REVISED_PLANS=true` if any changes were made.
```

Also update the accept/reject log table to include a "Noted" row and update the summary line:
```
| 3 | {agent} | {feedback summary} | Noted | {why} |

{N} suggestions accepted, {M} rejected, {P} noted
```

**Gap 2 — Dynamic commit scope (line 581):**
Replace:
```
docs(08): incorporate co-planner feedback (plans)
```
With:
```
docs(${PHASE}): incorporate co-planner feedback (plans)
```

`${PHASE}` is already available as a normalized variable from step 2 of plan-phase.md (line 90).
  </action>
  <verify>
Verify all four fixes:
1. `grep -n "CO_PLANNER_REVISED_PLANS=true" commands/gsd/plan-phase.md` — must find the flag assignment line
2. `grep -n "CO_PLANNER_REVISED_PLANS" commands/gsd/plan-phase.md` — must find both the assignment and the check
3. `grep -n 'docs(${PHASE})' commands/gsd/plan-phase.md` — must find dynamic scope (no hardcoded 08)
4. `grep -n "Accept.*if feedback identifies" commands/gsd/plan-phase.md` — must find acceptance criteria
5. `grep -n "ALL agents failed" commands/gsd/plan-phase.md` — must find the all-agents-failed handler
6. `grep -c 'docs(08)' commands/gsd/plan-phase.md` — should return 0 (no hardcoded scope remaining in co-planner section)
  </verify>
  <done>plan-phase.md co-planner section has: flag assignment before conditional check, dynamic commit scope using ${PHASE}, explicit Accept-if/Reject-if/Note-if criteria, and all-agents-failed handler</done>
</task>

<task type="auto">
  <name>Task 2: Fix co-planner review section in execute-phase.md (4 gaps)</name>
  <files>commands/gsd/execute-phase.md</files>
  <action>
Apply four targeted edits to the step 7.3 co-planner review section in execute-phase.md. Use new-project.md lines 1342-1378 as the reference pattern.

**Gap 1 — All-agents-failed handler (after line 180):**
After the error-check step (step 3, "Skip to next agent."), add a new step 4:

```
   4. **If ALL agents failed:** Display warning and skip to step 7.5.
      ```
      ⚠ All co-planners failed. Proceeding with adversary review only.
      ```
```

Renumber the existing step 4 ("Display attributed feedback block") to step 5.

**Gap 3 — Acceptance criteria (replace lines ~200-202):**
Replace the bare synthesis instructions:
```
   Synthesize: Review all suggestions and challenges. For each:
   - Accept: apply change to VERIFICATION.md via Edit tool
   - Reject: note with brief reasoning
```

With the full criteria pattern (adapted for verification artifacts):
```
   **Co-Planner Synthesis:**

   Review all suggestions and challenges. For each feedback item, apply acceptance criteria:

   - **Accept** if feedback identifies: a missed verification case, a factually incorrect status in the report, a gap between must-haves and evidence, a false-positive verification where the check passed but the behavior is broken, or a conclusion not supported by the evidence cited.
   - **Reject** if feedback is: stylistic/formatting preference, a scope expansion beyond the phase goal, speculative ("might need") without evidence, or duplicates an existing verification entry.
   - **Note** if feedback is: valid but deferred to a later phase, or raises a concern already captured in the verification constraints.
```

**Gap 1 — Flag assignment (replace line ~201 area):**
After the acceptance criteria, add the flag-assignment instruction:
```
   Apply accepted changes to VERIFICATION.md via Edit tool. Set `CO_PLANNER_REVISED_VERIFICATION=true` if any changes were made.
```

Also update the accept/reject log table to include a "Noted" row and update the summary line:
```
   | 3 | {agent} | {feedback summary} | Noted | {why} |

   {N} suggestions accepted, {M} rejected, {P} noted
```

**Gap 2 — Dynamic commit scope (line 221):**
Replace:
```
   docs(08): incorporate co-planner feedback (verification)
```
With:
```
   docs({phase}): incorporate co-planner feedback (verification)
```

execute-phase.md uses `{phase}` as its template variable for phase number (see line 96 pattern: `fix({phase}): orchestrator corrections`). Use the same pattern.
  </action>
  <verify>
Verify all four fixes:
1. `grep -n "CO_PLANNER_REVISED_VERIFICATION=true" commands/gsd/execute-phase.md` — must find the flag assignment line
2. `grep -n "CO_PLANNER_REVISED_VERIFICATION" commands/gsd/execute-phase.md` — must find both the assignment and the check
3. `grep -n 'docs({phase})' commands/gsd/execute-phase.md` — must find dynamic scope (no hardcoded 08)
4. `grep -n "Accept.*if feedback identifies" commands/gsd/execute-phase.md` — must find acceptance criteria
5. `grep -n "ALL agents failed" commands/gsd/execute-phase.md` — must find the all-agents-failed handler
6. `grep -c 'docs(08)' commands/gsd/execute-phase.md` — should return 0 (no hardcoded scope remaining in co-planner section)
  </verify>
  <done>execute-phase.md co-planner section has: flag assignment before conditional check, dynamic commit scope using {phase}, explicit Accept-if/Reject-if/Note-if criteria, and all-agents-failed handler</done>
</task>

</tasks>

<verification>
After both tasks complete, verify cross-file consistency:

1. Both files have the full co-planner synthesis pattern: criteria -> flag assignment -> log table -> conditional commit
2. Acceptance criteria are domain-appropriate: plan-phase uses plan-specific criteria (logical gaps, dependency conflicts, task ordering), execute-phase uses verification-specific criteria (missed cases, incorrect status, false positives)
3. No hardcoded `docs(08):` remains in either file's co-planner section
4. Flag names match between assignment and check: CO_PLANNER_REVISED_PLANS in plan-phase.md, CO_PLANNER_REVISED_VERIFICATION in execute-phase.md
5. All-agents-failed handler in both files references the correct next step (12.5 in plan-phase, 7.5 in execute-phase)
</verification>

<success_criteria>
- All 4 gaps from VERIFICATION.md are closed in both files
- plan-phase.md and execute-phase.md co-planner sections match the quality standard set by new-project.md
- No new issues introduced (existing functionality preserved)
- Conditional commits will actually fire when co-planner feedback is accepted
</success_criteria>

<output>
After completion, create `.planning/phases/08-workflow-integration/08-03-SUMMARY.md`
</output>
