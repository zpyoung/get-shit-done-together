---
phase: 08-workflow-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd/plan-phase.md
  - commands/gsd/execute-phase.md
autonomous: true

must_haves:
  truths:
    - "Co-planner review runs before adversary review at the plan checkpoint in plan-phase"
    - "Co-planner review runs before adversary review at the verification checkpoint in execute-phase"
    - "Each co-planner agent's feedback is displayed in a bordered, attributed block before synthesis"
    - "An explicit accept/reject log is displayed after synthesizing co-planner feedback"
    - "When no co-planner agents are configured, the section is silently skipped and adversary review runs normally"
    - "Skip-to references in plan-phase now route through co-planner review (step 12.3) before adversary (step 12.5)"
    - "Skip-to reference in execute-phase now routes through co-planner review (step 7.3) before adversary (step 7.5)"
  artifacts:
    - path: "commands/gsd/plan-phase.md"
      provides: "Co-planner review section at step 12.3 (plan)"
      contains: "12.3"
    - path: "commands/gsd/execute-phase.md"
      provides: "Co-planner review section at step 7.3 (verification)"
      contains: "7.3"
  key_links:
    - from: "commands/gsd/plan-phase.md step 12.3"
      to: "gsd-tools.cjs coplanner agents plan"
      via: "bash invocation for agent resolution"
      pattern: "coplanner agents.*plan"
    - from: "commands/gsd/execute-phase.md step 7.3"
      to: "gsd-tools.cjs coplanner agents verification"
      via: "bash invocation for agent resolution"
      pattern: "coplanner agents.*verification"
---

<objective>
Add co-planner review sections to `commands/gsd/plan-phase.md` (plan checkpoint) and `commands/gsd/execute-phase.md` (verification checkpoint).

Purpose: Complete the draft-review-synthesize pattern at all four checkpoint types by adding co-planner review to the plan and verification checkpoints, ensuring external agents can provide refinement feedback on PLAN.md files and VERIFICATION.md before adversary challenge.

Output: Two new sections -- step 12.3 in plan-phase.md and step 7.3 in execute-phase.md -- each following the co-planner review pattern. Skip-to references updated to route through co-planner review first.
</objective>

<execution_context>
@/Users/zpyoung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zpyoung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-workflow-integration/08-RESEARCH.md
@.planning/phases/08-workflow-integration/08-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add co-planner review at plan checkpoint (Step 12.3) and update skip-to references</name>
  <files>commands/gsd/plan-phase.md</files>
  <action>
**Part A: Insert co-planner review section**

Insert a new section `## 12.3. Co-Planner Review -- Plans` immediately BEFORE the existing `## 12.5. Adversary Review -- Plans` (line 472).

Follow the same co-planner review structure as new-project.md sections with these plan-checkpoint-specific differences:

1. Agent resolution uses checkpoint `"plan"` via full bash invocation:
   ```bash
   node ~/.claude/get-shit-done/bin/gsd-tools.cjs coplanner agents "plan"
   ```
2. The artifact(s) read from disk are ALL PLAN.md files in the phase directory: `cat "${PHASE_DIR}"/*-PLAN.md`
3. Also read REQUIREMENTS.md and ROADMAP.md for context if they exist: `cat .planning/REQUIREMENTS.md .planning/ROADMAP.md 2>/dev/null` (plans implement requirements per roadmap phases)
4. The review prompt focuses on plan-specific concerns: COMPLETENESS (tasks atomic enough? each verifiable independently?), WIRING (integration points explicitly planned? component A connects to component B?), EDGE CASES (what could go wrong? error states handled?), COMPLEXITY (tasks hiding significant complexity?)
5. Ask agent to organize response into three sections: **Suggestions**, **Challenges**, **Endorsements**
6. Synthesis applies accepted changes to the relevant PLAN.md file(s) via Write tool (NOT Edit -- Edit is not in plan-phase.md's allowed-tools)
7. The conditional commit message is `docs(08): incorporate co-planner feedback (plans)`

Standard elements (banner, per-agent loop, error handling, feedback display, synthesis pattern, accept/reject log) follow the same pattern as requirements/roadmap checkpoints.

**Part B: Update skip-to references**

Three existing references point directly to step 12.5 and need updating to step 12.3:

1. Line 333: `If --skip-verify: Skip to step 12.5 (adversary review, which has its own skip logic)` -- change to `Skip to step 12.3 (co-planner review, which routes to adversary at 12.5)`
2. Line 335: `If workflow.plan_check is false: Skip to step 12.5` -- change to `Skip to step 12.3`
3. Line 403: `Proceed to step 12.5 (adversary review)` -- change to `Proceed to step 12.3 (co-planner review)`

This ensures all paths that previously jumped to adversary review now flow through co-planner review first. The co-planner section handles its own skip logic (empty agents = skip to 12.5).

Total: ~100 lines of markdown instructions + 3 line edits.
  </action>
  <verify>
Grep for "12.3" in commands/gsd/plan-phase.md -- must find the new section header. Verify "12.3" appears BEFORE "12.5" in the file. Verify the section contains: `coplanner agents "plan"`, `coplanner invoke`, `Co-Planner Synthesis`. Verify old references to "step 12.5" are updated to "step 12.3" at the three locations (search for "12.5" -- should only appear in the adversary section header and within the co-planner skip logic, not in routing references).
  </verify>
  <done>
Step 12.3 co-planner review section exists in plan-phase.md immediately before step 12.5, with plan-tailored review prompt and all standard co-planner review components. All three skip-to references updated from 12.5 to 12.3.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add co-planner review at verification checkpoint (Step 7.3) and update skip-to reference</name>
  <files>commands/gsd/execute-phase.md</files>
  <action>
**Part A: Insert co-planner review section**

Insert a new section `7.3. **Co-Planner Review -- Verification**` immediately BEFORE the existing `7.5. **Adversary Review -- Verification**` (line 113). Match the indentation/heading style of execute-phase.md (which uses numbered steps with bold text, not `##` headers).

Follow the same co-planner review structure with these verification-checkpoint-specific differences:

1. Agent resolution uses checkpoint `"verification"` via full bash invocation:
   ```bash
   node ~/.claude/get-shit-done/bin/gsd-tools.cjs coplanner agents "verification"
   ```
2. The artifact read from disk is VERIFICATION.md from the phase directory: `cat "${PHASE_DIR}"/*-VERIFICATION.md`
3. Also read the phase goal from ROADMAP.md and the must_haves from the PLAN.md frontmatter for context: `cat .planning/ROADMAP.md 2>/dev/null`
4. The review prompt focuses on verification-specific concerns: COVERAGE (were all must-haves verified with evidence?), BLIND SPOTS (what wasn't checked that should have been?), FALSE POSITIVES (could passing checks hide real issues?), CONCLUSION VALIDITY (conclusions justified by evidence?)
5. Ask agent to organize response into three sections: **Suggestions**, **Challenges**, **Endorsements**
6. Synthesis applies accepted changes to VERIFICATION.md via Edit tool (Edit IS in execute-phase.md's allowed-tools -- use targeted edits, not full file rewrites)
7. The conditional commit message is `docs(08): incorporate co-planner feedback (verification)`

**Additional skip conditions** (match adversary skip conditions):
- If verification status is already `gaps_found` -- skip co-planner review (verifier already found problems, external review is redundant)
- If VERIFICATION.md has `re_verification:` metadata -- skip (gap-closure re-check)

Standard elements (banner, per-agent loop, error handling, feedback display, synthesis pattern, accept/reject log) follow the same pattern.

**Part B: Update skip-to reference and skip comment**

Two existing lines need updating:

1. Line 104: `This skips both verification and adversary review, since there is no VERIFICATION.md to challenge.` -- change to `This skips verification, co-planner review, and adversary review, since there is no VERIFICATION.md to review or challenge.`
2. Line 111: `Continue to step 7.5 (adversary review). Status routing happens after adversary review.` -- change to `Continue to step 7.3 (co-planner review). Status routing happens after adversary review.`

This ensures: (a) the skip-all comment at line 104 accurately reflects that co-planner review is also skipped when verifier is disabled, and (b) the verification flow routes through co-planner review before adversary review. The co-planner section handles skip logic and falls through to 7.5.

Total: ~100 lines of markdown instructions + 2 line edits.
  </action>
  <verify>
Grep for "7.3" in commands/gsd/execute-phase.md -- must find the new section. Verify "7.3" appears BEFORE "7.5" in the file. Verify the section contains: `coplanner agents "verification"`, `coplanner invoke`, `Co-Planner Synthesis`. Verify the old reference to "step 7.5" on line 111 now says "step 7.3". Verify line 104's skip comment mentions "co-planner review" in addition to "verification and adversary review".
  </verify>
  <done>
Step 7.3 co-planner review section exists in execute-phase.md immediately before step 7.5, with verification-tailored review prompt, gap_found/re_verification skip conditions, and all standard co-planner review components. Skip-to reference updated from 7.5 to 7.3.
  </done>
</task>

</tasks>

<verification>
1. `grep -n "12.3" commands/gsd/plan-phase.md` returns line number(s)
2. `grep -n "7.3" commands/gsd/execute-phase.md` returns line number(s)
3. Step 12.3 line number < step 12.5 line number in plan-phase.md
4. Step 7.3 line number < step 7.5 line number in execute-phase.md
5. Both sections contain: `coplanner agents`, `coplanner invoke`, `Co-Planner Synthesis`, conditional commit
6. Old skip-to references updated: no routing references to "step 12.5" or "step 7.5" remain outside the adversary section headers and co-planner skip logic
7. execute-phase.md co-planner section has skip conditions matching adversary (gaps_found, re_verification)
8. execute-phase.md line 104 skip comment mentions co-planner review alongside verification and adversary review
</verification>

<success_criteria>
- plan-phase.md has review sections in order: 12.3 (co-planner plan), 12.5 (adversary plan)
- execute-phase.md has review sections in order: 7.3 (co-planner verification), 7.5 (adversary verification)
- Each co-planner section uses the correct checkpoint name for agent resolution
- Each co-planner section has a checkpoint-tailored review prompt
- Skip-to references route through co-planner review first (3 in plan-phase, 1 in execute-phase)
- Feedback display uses bordered attributed blocks per agent
- Accept/reject log template is present in both sections
- Conditional commit with `docs(08):` scoped message is present in both sections
- Task 1 synthesis uses Write tool (plan-phase.md lacks Edit); Task 2 synthesis uses Edit tool (execute-phase.md has Edit)
</success_criteria>

<output>
After completion, create `.planning/phases/08-workflow-integration/08-02-SUMMARY.md`
</output>
